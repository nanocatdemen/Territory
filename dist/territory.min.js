var CubeCoordinateSet=function(){this.elements={}};CubeCoordinateSet.prototype.get=function(e){if(e.x+e.y+e.z!=0)throw"Error: invalid cube coordinate";return this.elements[e.x.toString()+","+e.y.toString()+","+e.z.toString()]},CubeCoordinateSet.prototype.set=function(e,t){if(e.x+e.y+e.z!=0)throw"Error: invalid cube coordinate";this.elements[e.x.toString()+","+e.y.toString()+","+e.z.toString()]=t};var Hexagon=fabric.util.createClass(fabric.Polygon,{type:"hexagon",initialize:function(e,t,n){n||(n={});for(var i=[],o=0;6>o;o++){var a=60*o,r=Math.PI/180*a,s={x:e.x+t*Math.cos(r),y:e.y+t*Math.sin(r)};i.push(s)}this.callSuper("initialize",i,n),this.set("perPixelTargetFind",!0),this.set("center",e),this.set("edgeSize",t)},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{center:this.get("center"),size:this.get("edgeSize")})}}),Grid=function(e,t){this.canvas=t.canvas;var n=t.hexagonSize,i=t.center;this.hexagons=new CubeCoordinateSet;for(hexagonCoorKey in e){var o=e[hexagonCoorKey][0],a=e[hexagonCoorKey][1],r=e[hexagonCoorKey][2];if(o+a+r==0){var s={x:i.x+1.5*n*o,y:i.y+Math.sqrt(3)/2*n*r-Math.sqrt(3)/2*n*a},c=new Hexagon(s,50,{fill:"#D3E5F0",stroke:"#1F8ACF",selectable:!1});this.hexagons.set({x:o,y:a,z:r},c)}}};Grid.prototype.draw=function(){for(hexagonKey in this.hexagons.elements)this.canvas.add(this.hexagons.elements[hexagonKey])};var config={};!function(){var e={width:800,height:800},t={x:e.width/2,y:e.height/2},n=[[0,0,0],[0,1,-1],[0,-1,1],[1,0,-1],[-1,0,1],[1,-1,0],[-1,1,0]],i=50;$.extend(config,{size:e},{center:t},{hexagonsCoors:n},{hexagonSize:i})}();var canvas=new fabric.Canvas("c",config.size);canvas.selection=!1;var g=new Grid(config.hexagonsCoors,{canvas:canvas,hexagonSize:config.hexagonSize,center:config.center});g.draw(),canvas.on("mouse:up",function(e){if(e.target){var t=e.target;t.clicked?(t.clicked=!1,t.setColor("#D3E5F0")):(t.clicked=!0,t.setColor("#FF968E"))}this.renderAll()});